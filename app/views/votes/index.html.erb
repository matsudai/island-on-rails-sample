<% content_for :title, "投票" %>

<div class="w-full">
  <div class="flex justify-between items-center">
    <h1 class="font-bold text-4xl">投票</h1>
  </div>

  <div class="mt-8 w-max mx-auto">
    <h2 class="font-bold text-2xl mb-4">投票する</h2>
    <% if @vote.errors.any? %>
      <div id="error_explanation" class="bg-red-50 text-red-500 px-3 py-2 font-medium rounded-md mt-3 mb-5">
        <h2><%= pluralize(@vote.errors.count, "error") %> prohibited this vote from being saved:</h2>

        <ul class="list-disc ml-6">
          <% @vote.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="flex flex-wrap gap-3">
      <% @candidates.each do |candidate| %>
        <%= form_with(model: @vote, url: votes_path, class: "inline-block") do |form| %>
          <%= form.hidden_field :candidate_id, value: candidate.id %>
          <%= form.submit "👍 #{candidate.name}", class: "rounded-md px-4 py-2.5 font-medium cursor-pointer border-2", style: "background-color: #{candidate.faded_color}; color: #{candidate.solid_color}; border-color: #{candidate.solid_color};" %>
        <% end %>
      <% end %>
    </div>
  </div>

  <div id="votes" class="mt-8 overflow-x-auto">
    <h2 class="font-bold text-2xl mb-4">すべての投票</h2>
    <% if @votes.any? %>
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Candidate</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created At</th>
            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @votes.each do |vote| %>
            <tr id="<%= dom_id vote %>">
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= vote.id %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium" style="color: <%= vote.candidate.solid_color %>;"><%= vote.candidate.name %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= vote.created_at.strftime("%Y-%m-%d %H:%M") %></td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <%= link_to "Delete", vote, method: :delete, class: "text-red-600 hover:text-red-900", data: { turbo_method: :delete } %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="text-center my-10">No votes found.</p>
    <% end %>
  </div>
</div>
